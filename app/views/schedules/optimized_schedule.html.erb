<main class="content">
  <div class="container-fluid">
    <div class="header">
      <h1 class="header-title">
        Schedules
      </h1>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"> <%= link_to "Dashboard", dashboards_path %> </a></li>
          <li class="breadcrumb-item active" aria-current="page"><%= link_to "Schedule", new_schedule_path %></li>
          <li class="breadcrumb-item active" aria-current="page">Optimized Schedule</li>
        </ol>
      </nav>
    </div>

    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-body">
            <div class="mb-3">
              <h2><strong>Run <%= @schedule_run.id %>, Case
                <%= link_to "←", params.merge(page: (@case_num.to_i - 1), run_id: @schedule_run.id).permit(:page, :run_id) %>
                <%= @case_num %>
                <%= link_to "→", params.merge(:page => (@case_num.to_i + 1), run_id: @schedule_run.id).permit(:page, :run_id) %>
                 of <%= @schedule_run.cases %>, HMC Score: <%= @schedules&.first&.hmc_score %>
                <!--TODO: hmc_score on the basis of selected case -->
                </strong></h2>
                <p>Each case represents a possible schedule.Click the left or right arrows above to see the previous or next case in this run.Statistics for this run are at the bottom.To create the 2020 event schedule from a given case,click the "apply..."" at the button at bottom.</p>
            <table class="table table-bordered" >
              <thead>
                <tr>
                  <th width="100">Week</th>
                  <th class="text-center" width="1000">Workshop</th>
                  <th width="50">Choice</th>
                </tr>
              </thead>
              <tbody>
                <% choices = [] %>
                <% assignments = 0 %>
                <% no_assignments = 0 %>
                <% @schedules.order(:week).each do |schedule| %>
                <tr>
                  <td><%= schedule.week %></td> 
                  <td><%= schedule_proposal(schedule.proposal) %></td> 
                  <td><%= schedule.choice %></td>
                  <% if schedule.choice.eql?(0) %>
                    <% no_assignments += 1 %>
                  <% elsif schedule.choice.eql?('') %>
                    
                  <% else %>
                    <% choices << schedule.choice %>
                    <% assignments += 1 %>
                  <% end %>
                </tr>
                <% end %>
              </tbody>
            </table>
          </div>

          <div>
            <h2 style ="color: #0000FF;"><u>Statistics for Above HMC Results</u></h2>
            <h5>Number of proposals: <%= (@schedules.pluck(:proposal) - [""]).count %></h5>
            <h5>Number of preferred assignments: <%= assignments %></h5>
            <h5>Number of 1st choice assignments: <%= choice_assignment(choices, 1) %></h5>
            <h5>Number of 2nd choice assignments: <%= choice_assignment(choices, 2) %></h5>
            <h5>Number of 3rd choice assignments: <%= choice_assignment(choices, 3) %></h5>
            <h5>Number of 4th choice assignments: <%= choice_assignment(choices, 4) %></h5>
            <h5>Number of 5th choice assignments: <%= choice_assignment(choices, 5) %></h5>
            <h5>Number of non-preferred assignments: <%= no_assignments %></h5>
            <h5>Number of manual assignments:
              <!-- TODO: manual assignments -->
            </h5>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>